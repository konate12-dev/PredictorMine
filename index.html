<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>PLUTO ‚Äî PREDICTOR MINE ‚≠êÔ∏è TRUQU√â üí£</title>
<style>
  /* ===== Reset & base ===== */
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#e9f5ff;background:#001426}
  a{color:inherit}
  button{cursor:pointer}
  /* ===== background canvas ===== */
  #bg{position:fixed;inset:0;z-index:0;pointer-events:none}
  /* ===== layout ===== */
  .page{position:relative;z-index:1;min-height:100vh;display:flex;flex-direction:column;align-items:center;padding:28px 16px}
  main{width:100%;max-width:980px}
  .card{background:linear-gradient(180deg, rgba(2,46,84,0.9), rgba(0,85,170,0.9));border-radius:16px;padding:18px;box-shadow:0 12px 40px rgba(0,30,80,0.45);color:#e9f8ff}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:70px;height:70px;border-radius:12px;background:linear-gradient(180deg,#00c2ff,#0077ff);display:flex;align-items:center;justify-content:center;font-weight:900;color:#03263a}
  h1{font-size:20px;margin:0}
  .promoSmall{font-weight:700;color:#ffeb99}
  /* ===== form ===== */
  .formRow{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
  label{font-size:13px;color:#dff3ff;font-weight:700;margin-bottom:6px}
  input[type=text]{padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.03);color:#eaf9ff;font-weight:700}
  .btnPrimary{background:#ffd600;color:#04233a;border:none;padding:10px 14px;border-radius:10px;font-weight:800}
  .btnSecondary{background:transparent;border:1px solid rgba(255,255,255,0.08);padding:10px 12px;border-radius:10px;color:#dff3ff}
  .muted{color:#a9d3ee;font-size:13px}
  /* ===== board ===== */
  .boardWrap{display:flex;gap:18px;flex-wrap:wrap;margin-top:14px}
  .left{flex:1;min-width:300px}
  .right{width:360px;min-width:260px}
  .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;padding:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px}
  .cell{background:#0e5bb8;height:68px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:22px;color:gold;position:relative;user-select:none}
  .cell.dim{opacity:0.16}
  .controls{display:flex;gap:8px;align-items:center;margin-top:12px;flex-wrap:wrap}
  .smallInfo{background:rgba(255,255,255,0.03);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);font-size:13px}
  .starsRow{display:flex;gap:6px;align-items:center;margin-top:8px}
  .starMini{font-size:20px}
  .tools{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}
  .history{max-height:160px;overflow:auto;background:rgba(255,255,255,0.02);border-radius:8px;padding:8px;margin-top:10px;font-size:13px}
  /* modal */
  .overlay{position:fixed;inset:0;background:rgba(3,6,18,0.7);display:none;align-items:center;justify-content:center;z-index:50}
  .modal{background:linear-gradient(180deg,#003f7a,#005ea2);padding:14px;border-radius:12px;width:92%;max-width:520px;color:#fff;box-shadow:0 20px 60px rgba(0,0,0,0.6)}
  .modal img{width:100%;border-radius:10px;object-fit:cover}
  .rowCenter{display:flex;gap:8px;align-items:center;justify-content:center;margin-top:10px}
  .danger{color:#ffdd99}
  /* footer */
  footer{margin-top:18px;color:#9fc7e5;font-size:13px;text-align:center}
  /* responsive */
  @media (max-width:820px){.right{width:100%}.boardWrap{flex-direction:column}}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="page">
  <main>
    <div class="card">
      <header>
        <div class="brand">
          <div class="logo">PLUTO</div>
          <div>
            <h1>PREDICTOR MINE ‚≠êÔ∏è TRUQU√â üí£</h1>
            <div class="muted">Interface officielle ‚Äî code promo obligatoire</div>
          </div>
        </div>
        <div class="promoSmall">Code promo 1win : <strong>PCP5</strong> ‚Äî 500% BONUS</div>
      </header>

      <!-- Form -->
      <div class="formRow" id="loginForm">
        <div style="flex:1;min-width:200px">
          <label for="promo">Code promo</label>
          <input id="promo" type="text" placeholder="PCP5" aria-label="Code promo" />
        </div>
        <div style="width:220px">
          <label for="userid">ID 1win (4-8 chiffres)</label>
          <input id="userid" type="text" placeholder="1234567" aria-label="ID utilisateur" />
        </div>
        <div style="display:flex;align-items:flex-end;gap:8px">
          <button class="btnPrimary" id="btnVerify">V√âRIFIER</button>
          <button class="btnSecondary" id="btnReset">RESET</button>
        </div>
      </div>
      <div id="error" class="muted" style="margin-top:6px;height:20px;color:#ffd6d6"></div>

      <div class="boardWrap" style="margin-top:14px">
        <div class="left">
          <div class="smallInfo">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div><strong id="roundLabel">TOUR ‚Äî</strong></div>
              <div class="muted">Ne partagez pas votre ID ‚Äî tout reste local</div>
            </div>
            <div id="grid" class="grid" style="margin-top:10px"></div>

            <div class="starsRow" id="starsRow"></div>
            <div class="controls">
              <button class="btnPrimary" id="btnPredict" disabled>PR√âDICTOR</button>
              <div id="cooldownMsg" style="min-width:180px;color:#ffeb99;font-weight:800"></div>
            </div>

            <div id="resultMsg" style="margin-top:8px;font-weight:800;color:#dff3ff"></div>
          </div>
        </div>

        <div class="right">
          <div class="smallInfo">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div style="font-weight:900">Outils pro</div>
              <div class="muted">Export & partage</div>
            </div>

            <div class="tools">
              <button class="btnSecondary" id="btnCopy">Copier positions</button>
              <button class="btnSecondary" id="btnExport">Exporter PNG</button>
              <button class="btnSecondary" id="btnHistoryClear">Effacer historique</button>
            </div>

            <div style="margin-top:12px;font-weight:800">Inscription</div>
            <div style="margin-top:8px">
              <div class="muted">Si tu n'as pas de compte 1win, inscris-toi :</div>
              <div class="rowCenter" style="margin-top:8px">
                <button class="btnPrimary" id="btnSignup">Je m'inscris</button>
                <button class="btnSecondary" id="btnAlready">D√©j√† inscrit</button>
              </div>
              <div style="margin-top:8px" class="muted">Lien & code promo affich√©s en haut ‚Äî 1 clic ouvre le lien</div>
            </div>

            <div style="margin-top:12px;font-weight:900">Historique</div>
            <div id="history" class="history"></div>
          </div>
        </div>
      </div>

      <footer>Rappel : le code promo <strong>PCP5</strong> est obligatoire ‚Äî l'ID n'est jamais envoy√©.</footer>
    </div>
  </main>
</div>

<!-- Modal inscription (image) -->
<div class="overlay" id="modalOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <button style="position:absolute;right:12px;top:12px;border-radius:8px;padding:6px;border:none;background:#fff;color:#003049;font-weight:900" id="modalClose">‚úï</button>
    <img src="https://supposed-copper-ycmbufd9mj.edgeone.app/IMG_5633.jpeg" alt="Inscription" />
    <div class="rowCenter" style="margin-top:12px">
      <button class="btnPrimary" id="modalSignup">Je m'inscris</button>
      <button class="btnSecondary" id="modalAlready">D√©j√† inscrit</button>
    </div>
    <div style="margin-top:10px;text-align:center" class="muted">Code promo : <strong>PCP5</strong> ‚Äî 500% BONUS</div>
  </div>
</div>

<script>
/* =========================
   Config & state
   ========================= */
const SIGNUP_LINK = "https://1wlucb.life/?open=register&p=hney"; // ton lien
const REQUIRED_PROMO = "PCP5";
let state = {
  verified: false,
  lastResult: null,
  round: 0,
  cooldown: false,
  cooldownTimer: null,
  cooldownRemaining: 0,
  lastPositions: [],
  history: [] // stock local (session only)
};

/* =========================
   Background animation (canvas points + lines)
   ========================= */
const canvas = document.getElementById('bg');
const ctx = canvas.getContext('2d');
let W, H, pts = [];
function resize() {
  W = canvas.width = innerWidth;
  H = canvas.height = innerHeight;
  initPoints();
}
function initPoints(){
  pts = [];
  const spacing = Math.max(70, Math.min(120, Math.floor(Math.min(W,H)/8)));
  for(let y=spacing; y<H; y+=spacing){
    for(let x=spacing; x<W; x+=spacing){
      pts.push({x:x+Math.random()*30-15, y:y+Math.random()*30-15, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3});
    }
  }
}
function drawBg(){
  ctx.clearRect(0,0,W,H);
  ctx.fillStyle = "rgba(0,200,255,0.06)";
  ctx.strokeStyle = "rgba(0,150,255,0.09)";
  ctx.lineWidth = 1;
  for(const p of pts){
    p.x += p.vx; p.y += p.vy;
    if(p.x<0||p.x>W) p.vx *= -1;
    if(p.y<0||p.y>H) p.vy *= -1;
    ctx.beginPath(); ctx.arc(p.x,p.y,2.2,0,Math.PI*2); ctx.fill();
  }
  for(let i=0;i<pts.length;i++){
    for(let j=i+1;j<pts.length;j++){
      const a=pts[i], b=pts[j];
      const dx=a.x-b.x, dy=a.y-b.y;
      const d=Math.hypot(dx,dy);
      if(d<110){
        ctx.globalAlpha = 1 - d/110;
        ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
      }
    }
  }
  ctx.globalAlpha = 1;
  requestAnimationFrame(drawBg);
}
addEventListener('resize', resize);
resize(); drawBg();

/* =========================
   UI elements
   ========================= */
const promoInput = document.getElementById('promo');
const idInput = document.getElementById('userid');
const btnVerify = document.getElementById('btnVerify');
const btnReset = document.getElementById('btnReset');
const errorEl = document.getElementById('error');

const gridEl = document.getElementById('grid');
const starsRow = document.getElementById('starsRow');
const btnPredict = document.getElementById('btnPredict');
const cooldownMsg = document.getElementById('cooldownMsg');
const roundLabel = document.getElementById('roundLabel');
const resultMsg = document.getElementById('resultMsg');

const btnCopy = document.getElementById('btnCopy');
const btnExport = document.getElementById('btnExport');
const historyEl = document.getElementById('history');
const btnHistoryClear = document.getElementById('btnHistoryClear');

const btnSignup = document.getElementById('btnSignup');
const btnAlready = document.getElementById('btnAlready');
const modalOverlay = document.getElementById('modalOverlay');
const modalClose = document.getElementById('modalClose');
const modalSignup = document.getElementById('modalSignup');
const modalAlready = document.getElementById('modalAlready');

const btnModalSignup = document.getElementById('modalSignup');

/* =========================
   Validation & verify
   ========================= */
btnVerify.addEventListener('click', ()=>{
  const promo = (promoInput.value||"").trim().toUpperCase();
  const uid = (idInput.value||"").trim();
  errorEl.textContent = "";
  if(promo !== REQUIRED_PROMO){
    errorEl.textContent = "Code promo invalide. Entrez PCP5.";
    return;
  }
  if(!/^\d{4,8}$/.test(uid)){
    errorEl.textContent = "ID invalide. Doit contenir 4 √† 8 chiffres.";
    return;
  }
  // verified locally (no sending)
  state.verified = true;
  errorEl.textContent = "";
  btnPredict.disabled = false;
  resultMsg.textContent = "Pr√©dictions activ√©es ‚Äî clique sur PR√âDICTOR";
  // show signup modal once when verified
  showModal();
});

btnReset.addEventListener('click', ()=>{
  promoInput.value = "";
  idInput.value = "";
  state.verified = false;
  state.history = [];
  updateHistory();
  btnPredict.disabled = true;
  errorEl.textContent = "";
  resultMsg.textContent = "";
  roundLabel.textContent = "TOUR ‚Äî";
});

/* =========================
   Prediction generation
   ========================= */
function chooseStarsWeighted(){
  const items = [{v:4,w:32},{v:5,w:32},{v:6,w:22},{v:7,w:14}];
  let total = items.reduce((s,i)=>s+i.w,0);
  let r=Math.random()*total;
  for(const it of items){ if(r<it.w) return it.v; r-=it.w; }
  return 4;
}
function generatePrediction(forced){
  const n = forced || chooseStarsWeighted();
  const bombs = new Set();
  while(bombs.size < 3) bombs.add(Math.floor(Math.random()*25));
  const nonBomb = [];
  for(let i=0;i<25;i++) if(!bombs.has(i)) nonBomb.push(i);
  const stars = [];
  while(stars.length < n){
    const s = nonBomb[Math.floor(Math.random()*nonBomb.length)];
    if(!stars.includes(s)) stars.push(s);
  }
  stars.sort((a,b)=>a-b);
  return {n, bombs: Array.from(bombs).sort((a,b)=>a-b), stars};
}

function renderPrediction(pred){
  gridEl.innerHTML = "";
  starsRow.innerHTML = "";
  for(let i=0;i<25;i++){
    const c = document.createElement('div');
    c.className = "cell";
    if(pred.stars.includes(i)){
      c.textContent = "‚≠êÔ∏è";
      c.classList.add('star');
    } else {
      c.textContent = "";
      c.classList.add('dim');
    }
    gridEl.appendChild(c);
  }
  // stars miniature
  pred.stars.forEach((s,idx)=>{
    const el = document.createElement('div');
    el.className = 'starMini';
    el.textContent = "‚≠êÔ∏è";
    el.style.fontSize = (16 + Math.min(18, idx*3)) + "px";
    starsRow.appendChild(el);
  });
  // update state
  state.round++;
  roundLabel.textContent = `TOUR ${state.round}`;
  state.lastPositions = pred.stars;
  state.history.unshift({time: new Date().toLocaleString(), stars: pred.stars.slice(), bombs: pred.bombs.slice()});
  updateHistory();
  // show result message
  resultMsg.textContent = "Nouvelle pr√©diction";
}

/* cooldown 30 seconds */
function startCooldown(seconds=30){
  if(state.cooldownTimer) clearInterval(state.cooldownTimer);
  state.cooldown = true;
  state.cooldownRemaining = seconds;
  btnPredict.disabled = true;
  cooldownMsg.textContent = `Attendez ${state.cooldownRemaining}s pour nouvelle pr√©diction`;
  state.cooldownTimer = setInterval(()=>{
    state.cooldownRemaining--;
    if(state.cooldownRemaining <= 0){
      clearInterval(state.cooldownTimer);
      state.cooldown = false;
      cooldownMsg.textContent = "";
      if(state.verified) btnPredict.disabled = false;
    } else {
      cooldownMsg.textContent = `Attendez ${state.cooldownRemaining}s pour nouvelle pr√©diction`;
    }
  },1000);
}

/* Predict button */
btnPredict.addEventListener('click', ()=>{
  if(!state.verified){
    errorEl.textContent = "Activez le code promo PCP5 + ID valide d'abord.";
    return;
  }
  if(state.cooldown){
    errorEl.textContent = `Patiente ${state.cooldownRemaining}s avant nouvelle pr√©diction.`;
    return;
  }
  const pred = generatePrediction();
  renderPrediction(pred);
  startCooldown(30); // 30s between predictions
});

/* =========================
   History & tools
   ========================= */
function updateHistory(){
  historyEl.innerHTML = "";
  for(const item of state.history.slice(0,30)){
    const div = document.createElement('div');
    div.style.padding = "6px 4px";
    div.style.borderBottom = "1px dashed rgba(255,255,255,0.03)";
    div.textContent = `${item.time} ‚Äî ‚≠ê ${item.stars.length} ‚Äî positions: ${item.stars.join(',')}`;
    historyEl.appendChild(div);
  }
}
btnHistoryClear.addEventListener('click', ()=>{
  if(!confirm("Effacer l'historique local ?")) return;
  state.history = [];
  updateHistory();
});

/* copy positions */
btnCopy.addEventListener('click', ()=>{
  if(!state.lastPositions || state.lastPositions.length===0){
    alert("Aucune pr√©diction √† copier.");
    return;
  }
  const text = `Positions √©toiles: ${state.lastPositions.join(',')}`;
  navigator.clipboard?.writeText(text).then(()=>{
    alert("Positions copi√©es !");
  }).catch(()=>{ prompt("Copie manuelle :", text); });
});

/* export PNG (draw grid to canvas) */
btnExport.addEventListener('click', async ()=>{
  // create a temporary canvas
  const size = 600;
  const cellSize = Math.floor((size - 40) / 5);
  const canvas2 = document.createElement('canvas');
  canvas2.width = size; canvas2.height = size;
  const c2 = canvas2.getContext('2d');
  // background
  c2.fillStyle = "#002f66"; c2.fillRect(0,0,size,size);
  // draw cells
  for(let i=0;i<25;i++){
    const col = i%5, row=Math.floor(i/5);
    const x = 20 + col*cellSize + col*4;
    const y = 20 + row*cellSize + row*4;
    c2.fillStyle = "#0e5bb8";
    c2.fillRect(x,y,cellSize,cellSize);
    // draw star?
    if(state.lastPositions.includes(i)){
      c2.font = `${Math.floor(cellSize*0.6)}px serif`;
      c2.textAlign = "center"; c2.textBaseline = "middle";
      c2.fillStyle = "#ffd700";
      c2.fillText("‚≠ê", x+cellSize/2, y+cellSize/2+2);
    }
  }
  // download
  const url = canvas2.toDataURL("image/png");
  const a = document.createElement('a'); a.href = url; a.download = `prediction_${Date.now()}.png`;
  document.body.appendChild(a); a.click(); a.remove();
});

/* =========================
   Signup modal behavior
   ========================= */
function showModal(){ modalOverlay.style.display = 'flex'; modalOverlay.setAttribute('aria-hidden','false'); }
function hideModal(){ modalOverlay.style.display = 'none'; modalOverlay.setAttribute('aria-hidden','true'); }

btnSignup.addEventListener('click', ()=> showModal());
btnAlready.addEventListener('click', ()=> { hideModal(); resultMsg.textContent = "Bienvenue ‚Äî tu peux maintenant jouer."; });

modalClose.addEventListener('click', hideModal);
modalAlready.addEventListener('click', ()=> { hideModal(); });

modalSignup.addEventListener('click', ()=>{
  // open link in new tab (one click)
  window.open(SIGNUP_LINK, '_blank', 'noopener');
});

/* =========================
   Safety note: do NOT send user's ID anywhere
   Everything is client-side; we don't POST or save to server.
   ========================= */

/* =========================
   Init & prefill grid
   ========================= */
function initGridBlank(){
  gridEl.innerHTML = "";
  for(let i=0;i<25;i++){
    const c = document.createElement('div'); c.className='cell dim'; c.textContent = ''; gridEl.appendChild(c);
  }
}
initGridBlank();

</script>
</body>
</html>
